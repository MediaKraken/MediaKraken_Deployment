(function($){$.fn.acornMediaPlayer=function(options){var defaults={theme:'access',nativeSliders:false,volumeSlider:'horizontal',captionsOn:false,tooltipsOn:true};options=$.extend(defaults,options);var uniqueID=function(){var currentDate=new Date();return currentDate.getTime();};function supports_local_storage(){try{return'localStorage'in window&&window.localStorage!==null;}catch(e){return false;}};var is_touch_device='ontouchstart'in document.documentElement;var volume=(supports_local_storage)?localStorage.getItem('acornvolume'):1;if(!volume){volume=1;};var acornPlayer=function(){ var acorn={$self:$(this)};var loadedMetadata; var seeking; var wasPlaying; var fullscreenMode; var captionsActive;;;; var autoplay=acorn.$self.prop('autoplay'); acorn.$self.prop('autoplay',false);var text={play:'Play',playTitle:'Start the playback',pause:'Pause',pauseTitle:'Pause the playback',mute:'Mute',unmute:'Unmute',fullscreen:'Fullscreen',fullscreenTitle:'Toggle fullscreen mode',volumeTitle:'Volume control',seekTitle:'Video seek control',captions:'Captions',captionsTitle:'Show captions',captionsChoose:'Choose caption',transcript:'Transcript',transcriptTitle:'Show transcript'}; var $wrapper=$('<div class="acorn-player" role="application"></div>').addClass(options.theme);acorn.$self.attr('tabindex','0');acorn.id=acorn.$self.attr('id');if(!acorn.id){acorn.id='acorn'+uniqueID();acorn.$self.attr('id',acorn.id);};var fullscreenBtnMarkup=(acorn.$self.is('video'))?'<button class="acorn-fullscreen-button" title="'+text.fullscreenTitle+'" aria-controls="'+acorn.id+'">'+text.fullscreen+'</button>':'';var tooltipMarkup=(options.tooltipsOn)?'<div class="acorn-tooltip"><div>':'';var template='<div class="acorn-controls">'+'<button class="acorn-play-button" title="'+text.playTitle+'" aria-controls="'+acorn.id+'">'+text.play+'</button>'+'<input type="range" class="acorn-seek-slider" title="'+text.seekTitle+'" value="0" min="0" max="150" step="0.1" aria-controls="'+acorn.id+'"/>'+'<span class="acorn-timer">00:00</span>'+'<div class="acorn-volume-box">'+'<button class="acorn-volume-button" title="'+text.mute+'" aria-controls="'+acorn.id+'">'+text.mute+'</button>'+'<input type="range" class="acorn-volume-slider" title="'+text.volumeTitle+'" value="1" min="0" max="1" step="0.05" aria-controls="'+acorn.id+'"/>'+'</div>'+;fullscreenBtnMarkup+'<button class="acorn-caption-button" title="'+text.captionsTitle+'"  aria-controls="'+acorn.id+'">'+text.captions+'</button>'+'<div class="acorn-caption-selector"></div>'+'<button class="acorn-transcript-button" title="'+text.transcriptTitle+'">'+text.transcript+'</button>'+'</div>'+;tooltipMarkup;var captionMarkup='<div class="acorn-caption"></div>';var transcriptMarkup='<div class="acorn-transcript" role="region" aria-live="assertive"></div>'; acorn.$self.after($wrapper); $wrapper[0].appendChild(acorn.$self[0].cloneNode(true));acorn.$self.remove();acorn.$self=$wrapper.find('video, audio'); acorn.$self.after(template).after('<div class="loading-media"></div>');acorn.$container=acorn.$self.parent('.acorn-player');acorn.$controls=$('.acorn-controls',acorn.$container);acorn.$playBtn=$('.acorn-play-button',acorn.$container);acorn.$seek=$('.acorn-seek-slider',acorn.$container);acorn.$timer=$('.acorn-timer',acorn.$container);acorn.$volume=$('.acorn-volume-slider',acorn.$container);acorn.$volumeBtn=$('.acorn-volume-button',acorn.$container);acorn.$fullscreenBtn=$('.acorn-fullscreen-button',acorn.$container);acorn.$tooltip=$('.acorn-tooltip',acorn.$container);acorn.$controls.after(captionMarkup);acorn.$container.after(transcriptMarkup);acorn.$transcript=acorn.$container.next('.acorn-transcript');acorn.$transcriptBtn=$('.acorn-transcript-button',acorn.$container);acorn.$caption=$('.acorn-caption',acorn.$container);acorn.$captionBtn=$('.acorn-caption-button',acorn.$container);acorn.$captionSelector=$('.acorn-caption-selector',acorn.$container);var timeFormat=function(sec){var m=Math.floor(sec/60)<10?"0"+Math.floor(sec/60):Math.floor(sec/60);var s=Math.floor(sec-(m*60))<10?"0"+Math.floor(sec-(m*60)):Math.floor(sec-(m*60));return m+":"+s;};var playMedia=function(){if(!acorn.$self.prop('paused')){acorn.$self.trigger('pause');}else{acorn.$self.trigger('play');};return false;};var startPlayback=function(){acorn.$playBtn.text(text.pause).attr('title',text.pauseTitle);acorn.$playBtn.addClass('acorn-paused-button'); if(!loadedMetadata)$wrapper.addClass('show-loading');};var stopPlayback=function(){acorn.$playBtn.text(text.play).attr('title',text.playTitle);acorn.$playBtn.removeClass('acorn-paused-button');};var seekUpdate=function(){var currenttime=acorn.$self.prop('currentTime');acorn.$timer.text(timeFormat(currenttime)); if(!seeking){if(options.nativeSliders){acorn.$seek.val(currenttime);}else{acorn.$seek.slider('value',currenttime);}} ;if(captionsActive){updateCaption();}};var ariaTimeFormat=function(sec){var m=Math.floor(sec/60)<10?""+Math.floor(sec/60):Math.floor(sec/60);var s=Math.floor(sec-(m*60))<10?""+Math.floor(sec-(m*60)):Math.floor(sec-(m*60));var formatedTime,min;var mins='minutes';var secs='seconds';if(m==1){min='minute';};if(s==1){sec='second';};if(m===0){formatedTime=s+' '+secs;}else{formatedTime=m+' '+mins+' '+s+' '+secs;};return formatedTime;};var blurCaptionBtn=function(){acorn.$captionBtn.trigger('blur');};var startSeek=function(e,ui){if(!acorn.$self.prop('paused')){wasPlaying=true;};acorn.$self.trigger('pause');seeking=true;var seekLocation;if(options.nativeSliders){seekLocation=acorn.$seek.val();}else{seekLocation=ui.value;};acorn.$self.prop('currentTime',seekLocation); blurCaptionBtn();};var endSeek=function(e,ui){if(wasPlaying){acorn.$self.trigger('play');wasPlaying=false;};seeking=false;if(!options.nativeSliders){$(ui.handle).attr({'aria-valuenow':parseInt(ui.value,10),'aria-valuetext':ariaTimeFormat(ui.value),'aria-label':'Video seek control'});}};var initSliderAccess=function(elem,opts){var accessDefaults={'role':'slider','aria-valuenow':parseInt(opts.value,10),'aria-valuemin':parseInt(opts.min,10),'aria-valuemax':parseInt(opts.max,10),'aria-valuetext':opts.valuetext,'aria-label':opts.label,'tabindex':'0'};elem.attr(accessDefaults);};var initSeek=function(){ var seekClass=acorn.$seek.attr('class'); var divSeek='<div class="'+seekClass+'" title="'+text.seekTitle+'"></div>';acorn.$seek.after(divSeek).remove(); acorn.$seek=$('.'+seekClass,acorn.$container); var bufferBar='<div class="ui-slider-range acorn-buffer"></div>';acorn.$seek.append(bufferBar); acorn.$buffer=$('.acorn-buffer',acorn.$container); var sliderOptions={value:0,step:1,orientation:'horizontal',range:'min',min:0,max:100}; acorn.$seek.slider(sliderOptions);};var updateSeek=function(){ var duration=acorn.$self.prop('duration'); if(options.nativeSliders){acorn.$seek.attr('max',duration);acorn.$seek.bind('change',startSeek);acorn.$seek.bind('mousedown',startSeek);acorn.$seek.bind('mouseup',endSeek);}else{ var sliderOptions={value:0,step:1,orientation:'horizontal',range:'min',min:0,max:duration,slide:startSeek,stop:endSeek,label:'Video seek control'}; acorn.$seek.slider('option',sliderOptions); sliderOptions.valuetext=ariaTimeFormat(sliderOptions.value); initSliderAccess(acorn.$seek.find('.ui-slider-handle'),sliderOptions); $('.ui-slider-handle',acorn.$seek).click(blurCaptionBtn); acorn.$self.bind('progress',showBuffer);} ;$wrapper.removeClass('show-loading');};var showBuffer=function(e){var max=parseInt(acorn.$self.prop('duration'),10);var tr=acorn.$self.prop('buffered');if(tr&&tr.length){var buffer=parseInt(tr.end(0)-tr.start(0),10);var bufferWidth=(buffer*100)/max;acorn.$buffer.css('width',bufferWidth+'%');}};var changeVolume=function(e,ui){ volume=ui.value; localStorage.setItem('acornvolume',volume); if(acorn.$self.prop('muted')){acorn.$self.prop('muted',false);acorn.$volumeBtn.removeClass('acorn-volume-mute');acorn.$volumeBtn.text(text.mute).attr('title',text.mute);} ;acorn.$self.prop('volume',volume); acorn.$volume.$handle.attr('aria-valuenow',Math.round(volume*100));acorn.$volume.$handle.attr('aria-valuetext',Math.round(volume*100)+' percent');acorn.$volume.$handle.attr('aria-label','Volume control'); blurCaptionBtn();};var muteVolume=function(){if(acorn.$self.prop('muted')===true){acorn.$self.prop('muted',false);if(options.nativeSliders){acorn.$volume.val(volume);}else{acorn.$volume.slider('value',volume);};acorn.$volumeBtn.removeClass('acorn-volume-mute');acorn.$volumeBtn.text(text.mute).attr('title',text.mute);}else{acorn.$self.prop('muted',true);if(options.nativeSliders){acorn.$volume.val('0');}else{acorn.$volume.slider('value','0');};acorn.$volumeBtn.addClass('acorn-volume-mute');acorn.$volumeBtn.text(text.unmute).attr('title',text.unmute);}};var initVolume=function(){if(options.nativeSliders){acorn.$volume.bind('change',function(){acorn.$self.prop('muted',false);volume=acorn.$volume.val();acorn.$self.prop('volume',volume);});}else{var volumeClass=acorn.$volume.attr('class');var divVolume='<div class="'+volumeClass+'" title="'+text.volumeTitle+'"></div>';acorn.$volume.after(divVolume).remove();acorn.$volume=$('.'+volumeClass,acorn.$container);var volumeSliderOptions={value:volume,orientation:options.volumeSlider,range:"min",max:1,min:0,step:0.1,animate:true,slide:changeVolume,label:"Volume control"};acorn.$volume.slider(volumeSliderOptions);acorn.$volume.$handle=acorn.$volume.find('.ui-slider-handle'); volumeSliderOptions.max=100;volumeSliderOptions.value=volumeSliderOptions.value*100;volumeSliderOptions.valuetext=volumeSliderOptions.value+' percent';initSliderAccess(acorn.$volume.$handle,volumeSliderOptions); $('.ui-slider-handle',acorn.$volume).click(blurCaptionBtn);};acorn.$volumeBtn.click(muteVolume);};var resizeFullscreenVideo=function(){acorn.$self.attr({'width':$(window).width(),'height':$(window).height()});};var goFullscreen=function(){var isPolyfill=acorn.$self.hasClass('nonnative-api-active');if(fullscreenMode){ if(!isPolyfill&&acorn.$self[0].cancelFullScreen){acorn.$self[0].cancelFullScreen();}else if(!isPolyfill&&acorn.$self[0].webkitCancelFullScreen){acorn.$self[0].webkitCancelFullScreen();}else if(!isPolyfill&&acorn.$self[0].mozCancelFullScreen){acorn.$self[0].mozCancelFullScreen();}else{ $('body').css('overflow','');acorn.$controls.removeClass('fullscreen-controls');acorn.$self.parent().removeClass('has-fullscreen-video');};fullscreenMode=false;}else{ if(!isPolyfill&&acorn.$self[0].requestFullscreen){acorn.$self[0].requestFullscreen();}else if(!isPolyfill&&acorn.$self[0].webkitRequestFullscreen){acorn.$self[0].webkitRequestFullscreen();}else if(!isPolyfill&&acorn.$self[0].mozRequestFullScreen){acorn.$self[0].mozRequestFullScreen();}else{$('body').css('overflow','hidden');acorn.$self.addClass('fullscreen-video');acorn.$self.parent().addClass('has-fullscreen-video');acorn.$controls.addClass('fullscreen-controls');};fullscreenMode=true;}};var showTooltip=function(e){if($(this).attr('title')){acorn.$tooltip.html($(this).attr('title')).addClass('show-tooltip');}};var hideTooltip=function(e){if($(this).attr('title')){acorn.$tooltip.removeClass('show-tooltip');}};var captions;var captionBtnActiveClass='acorn-caption-active';var captionBtnLoadingClass='acorn-caption-loading';var transcriptBtnActiveClass='acorn-transcript-active';var captionRadioName='acornCaptions'+uniqueID();var captionOff=function(){captions='';acorn.$caption.hide();captionsActive=false;acorn.$transcriptBtn.removeClass(transcriptBtnActiveClass).hide();acorn.$transcript.hide();acorn.$captionBtn.removeClass(captionBtnActiveClass);};var updateCaption=function(){var now=acorn.$self.prop('currentTime'),text='',i,captionsLength=captions.length;for(i=0;i<captionsLength;i++){if(now>=captions[i].start&&now<=captions[i].end){text=captions[i].content; break;}};acorn.$caption.html(text);};var initCaptionSelector=function(){ var setUpCaptionSelector=function(){var pos=acorn.$captionBtn.offset();var top=pos.top-acorn.$captionSelector.outerHeight(true);var left=pos.left-((acorn.$captionSelector.outerWidth(true)-acorn.$captionBtn.outerWidth(true))/2);var parentPos=acorn.$controls.offset();left=left-parentPos.left;top=top-parentPos.top;acorn.$captionSelector.css({'top':top,'left':left});};acorn.$fullscreenBtn.click(setUpCaptionSelector);$(window).resize(function(){setUpCaptionSelector();});setUpCaptionSelector();var hideSelector; var showCaptionSelector=function(){if(hideSelector){clearTimeout(hideSelector);};acorn.$captionSelector.show();};var hideCaptionSelector=function(){hideSelector=setTimeout(function(){acorn.$captionSelector.hide();},200);};acorn.$captionBtn.click(function(){$(this).focus();});acorn.$captionBtn.bind('focus',showCaptionSelector);acorn.$captionBtn.bind('blur',hideCaptionSelector);$('input[name='+captionRadioName+']',acorn.$container).bind('focus',showCaptionSelector);$('input[name='+captionRadioName+']',acorn.$container).bind('blur',hideCaptionSelector);acorn.$captionSelector.attr('tabindex','-1');acorn.$captionSelector.bind('focus',showCaptionSelector);acorn.$captionSelector.bind('blur',hideCaptionSelector);};var loadCaption=function(url){ acorn.$captionBtn.addClass(captionBtnLoadingClass); $.ajax({url:url,success:function(data){captions=parseSrt(data); acorn.$transcriptBtn.show();var transcriptText='';$(captions).each(function(){transcriptText+='<span data-begin="'+parseInt(this.start,10)+'" data-end='+parseInt(this.end,10)+'>'+this.content.replace("'","")+'</span>';}); acorn.$transcript.html(transcriptText); acorn.$caption.show();captionsActive=true; if(acorn.$self.prop('paused')){updateCaption();};acorn.$captionBtn.addClass(captionBtnActiveClass).removeClass(captionBtnLoadingClass);},error:function(){ captionOff(); if(console){console.log('Error loading captions');}}});};var showTranscript=function(){if($(this).hasClass(transcriptBtnActiveClass)){acorn.$transcript.hide();}else{acorn.$transcript.show();};$(this).toggleClass(transcriptBtnActiveClass);};var initCaption=function(){ acorn.$track=$('track',acorn.$self); if(acorn.$track.length){acorn.$captionBtn.show();}; ;if(acorn.$track.length>1){ acorn.$captionBtn.attr('title',text.captionsChoose); var captionList='<ul><li><label><input type="radio" name="'+captionRadioName+'" checked="true" />None</label></li>';acorn.$track.each(function(){var tracksrc=$(this).attr('src');captionList+='<li><label><input type="radio" name="'+captionRadioName+'" data-url="'+$(this).attr('src')+'" />'+$(this).attr('label')+'</label></li>';});captionList+='</ul>'; acorn.$captionSelector.html(captionList); var changeCaption=function(){ var tracksrc=$(this).attr('data-url');if(tracksrc){loadCaption(tracksrc);}else{ captionOff();}}; $('input[name='+captionRadioName+']',acorn.$container).change(changeCaption); initCaptionSelector(); var firstCaption=acorn.$track.first().attr('src');if(options.captionsOn){loadCaption(firstCaption);$('input[name='+captionRadioName+']',acorn.$container).prop('checked',false);$('input[name='+captionRadioName+']:eq(1)',acorn.$container).prop('checked',true);};}else if(acorn.$track.length){; var tracksrc=acorn.$track.attr('src');acorn.$captionBtn.bind('click',function(){if(acorn.$captionBtn.hasClass(captionBtnActiveClass)){captionOff();}else{loadCaption(tracksrc);acorn.$captionBtn.addClass(captionBtnActiveClass);}}); if(options.captionsOn)loadCaption(tracksrc);} ;acorn.$transcriptBtn.bind('click',showTranscript);};var init=function(){ acorn.$playBtn.bind((is_touch_device)?'touchstart':'click',playMedia);if(document.createElement('video').canPlayType){acorn.$self.bind((is_touch_device)?'touchstart':'click',playMedia);};acorn.$self.bind('play',startPlayback);acorn.$self.bind('pause',stopPlayback);acorn.$self.bind('ended',stopPlayback); acorn.$self.bind('timeupdate',seekUpdate); acorn.$fullscreenBtn.click(goFullscreen); if(options.tooltipsOn){acorn.$controls.find('button').mouseover(showTooltip).mouseout(hideTooltip);} ;initVolume();if(!options.nativeSliders)initSeek(); acorn.$self.bind('loadedmetadata',function(){var t=window.setInterval(function(){if(acorn.$self.prop('readyState')>0){loadedMetadata=true;updateSeek();clearInterval(t);}},500);initCaption();});; acorn.$self.prop('controls',false);if(acorn.$self.is('audio')){acorn.$container.addClass('audio-player');};if($.fn.updatePolyfill){$wrapper.updatePolyfill();} ;if(autoplay)acorn.$self.trigger('play');}();}; return this.each(acornPlayer);};})(jQuery);function parseSrt(data){var srt=data.replace(/\r+/g,''); srt=srt.replace(/^\s+|\s+$/g,''); srt=srt.replace(/<[a-zA-Z\/][^>]*>/g,'');; var captions=[];var caplist=srt.split('\n\n');for(var i=0;i<caplist.length;i=i+1){var caption="";var content,start,end,s;caption=caplist[i];s=caption.split(/\n/);if(s[0].match(/^\d+$/)&&s[1].match(/\d+:\d+:\d+/)){ ;var m=s[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);if(m){start=(parseInt(m[1],10)*60*60)+;(parseInt(m[2],10)*60)+;(parseInt(m[3],10))+;(parseInt(m[4],10)/1000);end=(parseInt(m[5],10)*60*60)+;(parseInt(m[6],10)*60)+;(parseInt(m[7],10))+;(parseInt(m[8],10)/1000);}else{ continue;} ;content=s.slice(2).join("<br>");}else{ continue;};captions.push({start:start,end:end,content:content});};return captions;}
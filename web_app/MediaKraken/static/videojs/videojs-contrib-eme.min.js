/**
 * videojs-contrib-eme
 * @version 2.0.1
 * @copyright 2017 
 * @license Apache-2.0
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsContribEme=e()}}(function(){return function e(t,n,i){function o(a,d){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!d&&u)return u(a,!0);if(r)return r(a,!0);var f=new Error("Cannot find module '"+a+"'");throw f.code="MODULE_NOT_FOUND",f}var s=n[a]={exports:{}};t[a][0].call(s.exports,function(e){var n=t[a][1][e];return o(n?n:e)},s,s.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){(function(e){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.videojs:"undefined"!=typeof e?e.videojs:null,o=t(i),r=function(e){var t=(e.video,e.keySystems),n=void 0;return Object.keys(t).forEach(function(e){var i={},o=t[e].audioContentType,r=t[e].videoContentType;o&&(i.audioCapabilities=[{contentType:o}]),r&&(i.videoCapabilities=[{contentType:r}]),n?n.catch(function(t){n=navigator.requestMediaKeySystemAccess(e,[i])}):n=navigator.requestMediaKeySystemAccess(e,[i])}),n},a=function(e){var t=e.mediaKeys,n=e.initDataType,i=e.initData,r=e.options,a=e.getLicense,d=t.createSession();d.addEventListener("message",function(e){a(r,e.message).then(function(e){return d.update(e)}).catch(o.default.log.error.bind(o.default.log.error,"failed to get and set license"))},!1),d.generateRequest(n,i).catch(o.default.log.error.bind(o.default.log.error,"Unable to create or initialize key session"))},d=function(e){var t=e.video,n=e.initDataType,i=e.initData,o=e.options,r=e.getLicense;t.mediaKeysObject?a({mediaKeys:t.mediaKeysObject,initDataType:n,initData:i,options:o,getLicense:r}):t.pendingSessionData.push({initDataType:n,initData:i})},u=function(e){var t=e.video,n=e.certificate,i=e.createdMediaKeys,o=e.options,r=e.getLicense;t.mediaKeysObject=i,n&&i.setServerCertificate(n);for(var d=0;d<t.pendingSessionData.length;d++){var u=t.pendingSessionData[d];a({mediaKeys:t.mediaKeysObject,initDataType:u.initDataType,initData:u.initData,options:o,getLicense:r})}return t.pendingSessionData=[],t.setMediaKeys(i)},f=function(e){return function(t,n){return new Promise(function(i,o){e(t,n,function(e,t){e&&o(e),i(t)})})}},s=function(e){var t=e.video,n=e.initDataType,i=e.initData,a=e.options;if(a&&a.keySystems){if("undefined"==typeof t.mediaKeysObject){var s=function(){t.mediaKeysObject=null,t.pendingSessionData=[];var e=void 0,n=void 0,i=r({video:t,keySystems:a.keySystems});return i?void i.then(function(i){return new Promise(function(o,r){t.keySystem=i.keySystem,n=a.keySystems[i.keySystem],n.getCertificate||o(i),n.getCertificate(a,function(t,n){return t?void r(t):(e=n,void o(i))})})}).then(function(e){return e.createMediaKeys()}).then(function(i){return u({video:t,certificate:e,createdMediaKeys:i,options:a,getLicense:f(n.getLicense)})}).catch(o.default.log.error.bind(o.default.log.error,"Failed to create and initialize a MediaKeys object")):(o.default.log.error("No supported key system found"),{v:void 0})}();if("object"==typeof s)return s.v}d({video:t,initDataType:n,initData:i,options:a,getLicense:t.keySystem?f(a.keySystems[t.keySystem].getLicense):null})}};n.standard5July2016=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){(function(i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof window?window.videojs:"undefined"!=typeof i?i.videojs:null,a=o(r),d=e("global/window"),u=o(d),f=e("./utils"),s="com.apple.fps.1_0",c=function(e){var t=e.initData,n=e.id,i=e.cert;"string"==typeof n&&(n=(0,f.stringToUint16Array)(n));var o=0,r=new ArrayBuffer(t.byteLength+4+n.byteLength+4+i.byteLength),a=new DataView(r),d=new Uint8Array(r,o,t.byteLength);d.set(t),o+=t.byteLength,a.setUint32(o,n.byteLength,!0),o+=4;var u=new Uint16Array(r,o,n.length);u.set(n),o+=u.byteLength,a.setUint32(o,i.byteLength,!0),o+=4;var s=new Uint8Array(r,o,i.byteLength);return s.set(i),new Uint8Array(r,0,r.byteLength)},y=function(e){var t=e.video,n=e.contentId,i=e.initData,o=e.cert,r=e.options,a=e.getLicense;return new Promise(function(e,d){if(t.webkitKeys||t.webkitSetMediaKeys(new u.default.WebKitMediaKeys(s)),!t.webkitKeys)return void d("Could not create MediaKeys");var f=t.webkitKeys.createSession("video/mp4",c({id:n,initData:i,cert:o}));return f?(f.contentId=n,f.addEventListener("webkitkeymessage",function(e){a(r,n,e.message,function(e,t){return e?void d(e):void f.update(new Uint8Array(t))})}),f.addEventListener("webkitkeyadded",function(t){e(t)}),void f.addEventListener("webkitkeyerror",function(e){d(e)})):void d("Could not create key session")})},l=function(e){return function(t,n){a.default.xhr({uri:e,responseType:"arraybuffer"},function(e,t,i){return e?void n(e):void n(null,new Uint8Array(i))})}},p=function(e,t){return(0,f.getHostnameFromUri)((0,f.uint8ArrayToString)(t))},v=function(e){return function(t,n,i,o){a.default.xhr({uri:e,method:"POST",responseType:"arraybuffer",body:i,headers:{"Content-type":"application/octet-stream"}},function(e,t,n){return e?void o(e):void o(null,n)})}},g=function(e){var t=e.video,n=e.initData,i=e.options,o=i.keySystems[s],r=o.getCertificate||l(o.certificateUri),d=o.getContentId||p,u=o.getLicense||v(o.licenseUri);return new Promise(function(e,t){r(i,function(n,i){return n?void t(n):void e(i)})}).then(function(e){return y({video:t,cert:e,initData:n,getLicense:u,options:i,contentId:d(i,n)})}).catch(a.default.log.error.bind(a.default.log.error))};n.default=g,t.exports=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":3,"global/window":4}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n};n.stringToUint16Array=i;var o=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))};n.uint8ArrayToString=o;var r=function(e){var t=document.createElement("a");return t.href=e,t.hostname};n.getHostnameFromUri=r},{}],4:[function(e,t,n){(function(e){"undefined"!=typeof window?t.exports=window:"undefined"!=typeof e?t.exports=e:"undefined"!=typeof self?t.exports=self:t.exports={}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(e,t,n){(function(i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof window?window.videojs:"undefined"!=typeof i?i.videojs:null,a=o(r),d=e("./eme"),u=e("./fairplay"),f=o(u),s=function(e,t){(0,d.standard5July2016)({video:e.target,initDataType:e.initDataType,initData:e.initData,options:t})},c=function(e,t){(0,f.default)({video:e.target,initData:e.initData,options:t})},y=function(e,t){"video"===e.$(".vjs-tech").tagName.toLowerCase()&&(e.tech_.el_.addEventListener("encrypted",function(n){s(n,a.default.mergeOptions(t,e.currentSource()))}),e.tech_.el_.addEventListener("webkitneedkey",function(n){c(n,a.default.mergeOptions(t,e.currentSource()))}))},l=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.ready(function(){y(e,a.default.mergeOptions({},t))}),this.eme.options=t},p=a.default.registerPlugin||a.default.plugin;p("eme",l),n.default=l,t.exports=n.default}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./eme":1,"./fairplay":2}]},{},[5])(5)});
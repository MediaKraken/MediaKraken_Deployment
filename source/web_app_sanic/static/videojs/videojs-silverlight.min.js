/*! videojs-silverlight - v0.0.0 - 2015-01-09
* Copyright (c) 2015 Afterster; Licensed Apache-2.0 */
videojs.Silverlight=videojs.MediaTechController.extend({init:function(a,b,c){videojs.MediaTechController.call(this,a,b,c);var d=b.source,e=a.id()+"_silverlight_api",f={id:e,jsinitfunction:"videojs.Silverlight.onInit",jscallbackfunction:"videojs.Silverlight.onEvent",width:a.width(),height:a.height()};this.player_=a,a.options.autoplay&&(f.autoplay=a.options.autoplay),a.options.preload&&(f.preload=a.options.preload);var g=videojs.util.mergeOptions(f,b.silverlightVars),h=videojs.util.mergeOptions({wmode:"opaque",windowless:"true",bgcolor:"#000000"},b.params),i=videojs.util.mergeOptions({id:e,name:e,"class":"vjs-tech"},b.attributes);d&&this.ready(function(){this.setSrc(d.src,d.type)});var j=b.parentEl,k=this.el_=videojs.Component.prototype.createEl("div",{id:a.id()+"temp_silverlight"});j.firstChild?j.insertBefore(k,j.firstChild):j.appendChild(k),b.startTime&&this.ready(function(){this.load(),this.play(),this.currentTime(b.startTime)}),this.lastState={name:"video_id",currentSource:"",currentTime:"0",duration:"0",paused:"false",muted:"false",ended:"true",volume:"1",bufferedBytes:"0",bufferedTime:"0",videoWidth:"0",videoHeight:"0"},a.ready(function(){a.trigger("loadstart")}),this.el_=videojs.Silverlight.embed(k,g,h,i),this.el_.tech=this}}),videojs.Silverlight.prototype.params=[],videojs.Silverlight.prototype.dispose=function(){this.el_&&this.el_.parentNode.removeChild(this.el_),videojs.MediaTechController.prototype.dispose.call(this)},videojs.Silverlight.prototype.src=function(a){return void 0===a?this.currentSrc():this.setSrc(a)},videojs.Silverlight.prototype.setSrc=function(a,b){a=videojs.Silverlight.getAbsoluteURL(a),void 0===b&&(b=""),this.getApi().setSrc(a,b)},videojs.Silverlight.prototype.currentSrc=function(){return this.currentSource_?this.currentSource_.src:this.lastState.currentSource},videojs.Silverlight.prototype.load=function(){this.getApi().loadMedia()},videojs.Silverlight.prototype.play=function(){this.getApi().playMedia()},videojs.Silverlight.prototype.ended=function(){return this.lastState.ended},videojs.Silverlight.prototype.pause=function(){this.getApi().pauseMedia()},videojs.Silverlight.prototype.paused=function(){return this.lastState.paused},videojs.Silverlight.prototype.currentTime=function(){return this.lastState.currentTime},videojs.Silverlight.prototype.setCurrentTime=function(a){this.getApi().setCurrentTime(a)},videojs.Silverlight.prototype.duration=function(){return this.lastState.duration},videojs.Silverlight.prototype.buffered=function(){return this.lastState.bufferedTime},videojs.Silverlight.prototype.volume=function(){return this.lastState.volume},videojs.Silverlight.prototype.setVolume=function(a){a&&a!==this.lastState.volume&&this.getApi().setVolume(a)},videojs.Silverlight.prototype.muted=function(){return this.lastState.muted},videojs.Silverlight.prototype.setMuted=function(a){this.getApi().setMuted(a)},videojs.Silverlight.prototype.supportsFullScreen=function(){return!0},videojs.Silverlight.prototype.enterFullScreen=function(){return this.getApi().setFullscreen(!0),!0},videojs.Silverlight.prototype.getApi=function(){return this.el_.Content.MediaElementJS},videojs.Silverlight.prototype.setLastState=function(a,b){switch(this.lastState=b,a){case"paused":this.player_.trigger("pause");break;case"loadedmetadata":this.player_.trigger(a),this.player_.trigger("durationchange");break;case"ended":this.player_.trigger("ended"),this.setCurrentTime(0);break;default:this.player_.trigger(a)}},videojs.Silverlight.onInit=function(a){var b=document.getElementById(a),c=b&&b.parentNode&&b.parentNode.player;c&&(b.player=c,videojs.Silverlight.checkReady(b.tech))},videojs.Silverlight.checkReady=function(a){a.getApi().stopMedia?a.triggerReady():setTimeout(function(){videojs.Silverlight.checkReady(a)},50)},videojs.Silverlight.onEvent=function(a,b,c){var d=document.getElementById(a);d.tech&&d.tech.setLastState(b,c)},videojs.Silverlight.embed=function(a,b,c,d){var e=videojs.Silverlight.getEmbedCode(b,c,d),f=videojs.Component.prototype.createEl("div",{innerHTML:e}).childNodes[0],g=a.parentNode;a.parentNode.replaceChild(f,a);var h=g.childNodes[0];return setTimeout(function(){h.style.display="block"},1e3),f},videojs.Silverlight.getEmbedCode=function(a,b,c){var d,e='<object data="data:application/x-silverlight-2," ',f="",g="",h="";if(a)for(d in a)f+=d+"="+a[d]+",";b=videojs.util.mergeOptions({source:videojs.options.silverlight.xap,initParams:f,minRuntimeVersion:"3.0.0.0",autoUpgrade:"true",allowScriptAccess:"always",allowNetworking:"all"},b);for(d in b)g+='<param name="'+d+'" value="'+b[d]+'" />';c=videojs.util.mergeOptions({width:"100%",height:"100%",tabindex:"-1"},c);for(d in c)h+=d+'="'+c[d]+'" ';return e+h+">"+g+"</object>"},videojs.Silverlight.getAbsoluteURL=function(a){return a.match(/^https?:\/\//)||(a=videojs.Component.prototype.createEl("div",{innerHTML:'<a href="'+a+'">x</a>'}).firstChild.href),a},videojs.options.silverlight={xap:"video-js.xap"},videojs.Silverlight.version=function(){var a,b=[0,0,0,0],c="0.0.0.0";if(window.ActiveXObject){try{if(a=new window.ActiveXObject("AgControl.AgControl")){var d=function(a,b,c,d){for(;a.isVersionSupported(b[0]+"."+b[1]+"."+b[2]+"."+b[3]);)b[c]+=d;b[c]-=d};d(a,b,0,1),d(a,b,1,1),d(a,b,2,1e4),d(a,b,2,1e3),d(a,b,2,100),d(a,b,2,10),d(a,b,2,1),d(a,b,3,1)}}catch(e){}c=b.join(".")}else navigator.plugins&&navigator.mimeTypes.length>0&&(a=navigator.plugins["Silverlight Plug-In"],a&&(c=a.description.replace(/.*\s(\d+\.\d+\.\d+\.\d+).*/,"$1")));return c},videojs.Silverlight.isSupported=function(){return videojs.Silverlight.version()[0]>=3},videojs.Silverlight.formats={"audio/mpeg":"MP3","audio/x-ms-wma":"WMA","video/x-ms-wmv":"WMV","audio/mp4":"M4A","video/mp4":"M4V","audio/wav":"WAV"},videojs.Silverlight.canPlaySource=function(a){if(!a.type)return"";var b=a.type.replace(/;.*/,"").toLowerCase();return b in videojs.Silverlight.formats?"maybe":""};
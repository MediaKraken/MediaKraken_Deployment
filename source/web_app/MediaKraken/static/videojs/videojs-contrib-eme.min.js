/**
 * videojs-contrib-eme
 * @version 3.2.0
 * @copyright 2018 
 * @license Apache-2.0
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.videojsContribEme=e()}}(function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var d="function"==typeof require&&require;if(!s&&d)return d(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return r(n||e)},f,f.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,r=function(e){return e&&e.__esModule?e:{default:e}}(i),o=e("./playready"),a=function(e){var t=void 0;return Object.keys(e).forEach(function(n){var i={},r=e[n].audioContentType,o=e[n].videoContentType;r&&(i.audioCapabilities=[{contentType:r}]),o&&(i.videoCapabilities=[{contentType:o}]),t=t?t.catch(function(e){return navigator.requestMediaKeySystemAccess(n,[i])}):navigator.requestMediaKeySystemAccess(n,[i])}),t};n.getSupportedKeySystem=a;var s=function(e){var t=e.mediaKeys,n=e.initDataType,i=e.initData,o=e.options,a=e.getLicense,s=e.removeSession,d=t.createSession();d.addEventListener("message",function(e){a(o,e.message).then(function(e){return d.update(e)}).catch(r.default.log.error.bind(r.default.log.error,"failed to get and set license"))},!1),d.addEventListener("keystatuseschange",function(e){var t=!1;d.keyStatuses.forEach(function(n,i){switch(n){case"expired":t=!0;break;case"internal-error":r.default.log.warn('Key status reported as "internal-error." Leaving the session open since we don\'t have enough details to know if this error is fatal.',e)}}),t&&d.close().then(function(){s(i)})},!1),d.generateRequest(n,i).catch(r.default.log.error.bind(r.default.log.error,"Unable to create or initialize key session"))};n.makeNewRequest=s;var d=function(e){var t=e.video,n=e.initDataType,i=e.initData,r=e.options,o=e.getLicense,a=e.removeSession;t.mediaKeysObject?s({mediaKeys:t.mediaKeysObject,initDataType:n,initData:i,options:r,getLicense:o,removeSession:a}):t.pendingSessionData.push({initDataType:n,initData:i})},u=function(e){var t=e.video,n=e.certificate,i=e.createdMediaKeys,r=e.options,o=e.getLicense,a=e.removeSession;t.mediaKeysObject=i,n&&i.setServerCertificate(n);for(var d=0;d<t.pendingSessionData.length;d++){var u=t.pendingSessionData[d];s({mediaKeys:t.mediaKeysObject,initDataType:u.initDataType,initData:u.initData,options:r,getLicense:o,removeSession:a})}return t.pendingSessionData=[],t.setMediaKeys(i)},f=function(e){return function(t,n,i){(0,o.requestPlayreadyLicense)(e,n,function(e,t,n){if(e)return void i(e);i(null,n)})}},l=function(e){return function(t,n,i){r.default.xhr({uri:e,method:"POST",responseType:"arraybuffer",body:n,headers:{"Content-type":"application/octet-stream"}},function(e,t,n){if(e)return void i(e);i(null,n)})}},y=function(e,t){return function(n,i){return new Promise(function(r,o){e(n,i,function(e,n){t&&t.tech_&&t.tech_.trigger("licenserequestattempted"),e&&o(e),r(n)})})}},c=function(e,t){if("string"==typeof t&&(t={url:t}),!t.url&&!t.getLicense)throw new Error("Neither URL nor getLicense function provided to get license");return t.url&&!t.getLicense&&(t.getLicense="com.microsoft.playready"===e?f(t.url):l(t.url)),t},p=function(e){var t=e.video,n=e.initDataType,i=e.initData,o=e.options,s=e.removeSession,f=e.player,l=Promise.resolve();if(void 0===t.mediaKeysObject){var p=function(){t.mediaKeysObject=null,t.pendingSessionData=[];var e=void 0,n=void 0;if(!(l=a(o.keySystems)))return r.default.log.error("No supported key system found"),{v:Promise.resolve()};l=l.then(function(i){return new Promise(function(r,a){if(t.keySystem=i.keySystem,n=c(i.keySystem,o.keySystems[i.keySystem]),!n.getCertificate)return void r(i);n.getCertificate(o,function(t,n){if(t)return void a(t);e=n,r(i)})})}).then(function(e){return e.createMediaKeys()}).then(function(i){return u({video:t,certificate:e,createdMediaKeys:i,options:o,getLicense:y(n.getLicense,f),removeSession:s})}).catch(r.default.log.error.bind(r.default.log.error,"Failed to create and initialize a MediaKeys object"))}();if("object"==typeof p)return p.v}return l.then(function(){d({video:t,initDataType:n,initData:i,options:o,getLicense:t.keySystem?y(c(t.keySystem,o.keySystems[t.keySystem]).getLicense,f):null,removeSession:s})})};n.standard5July2016=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./playready":4}],2:[function(e,t,n){(function(t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,o=i(r),a=e("global/window"),s=i(a),d=e("./utils");n.FAIRPLAY_KEY_SYSTEM="com.apple.fps.1_0";var u=function(e){var t=e.initData,n=e.id,i=e.cert;"string"==typeof n&&(n=(0,d.stringToUint16Array)(n));var r=0,o=new ArrayBuffer(t.byteLength+4+n.byteLength+4+i.byteLength),a=new DataView(o);new Uint8Array(o,r,t.byteLength).set(t),r+=t.byteLength,a.setUint32(r,n.byteLength,!0),r+=4;var s=new Uint16Array(o,r,n.length);return s.set(n),r+=s.byteLength,a.setUint32(r,i.byteLength,!0),r+=4,new Uint8Array(o,r,i.byteLength).set(i),new Uint8Array(o,0,o.byteLength)},f=function(e){var t=e.video,n=e.contentId,i=e.initData,r=e.cert,o=e.options,a=e.getLicense,d=e.player;return new Promise(function(e,f){if(t.webkitKeys||t.webkitSetMediaKeys(new s.default.WebKitMediaKeys("com.apple.fps.1_0")),!t.webkitKeys)return void f("Could not create MediaKeys");var l=t.webkitKeys.createSession("video/mp4",u({id:n,initData:i,cert:r}));if(!l)return void f("Could not create key session");l.contentId=n,l.addEventListener("webkitkeymessage",function(e){a(o,n,e.message,function(e,t){if(d&&d.tech_&&d.tech_.trigger("licenserequestattempted"),e)return void f(e);l.update(new Uint8Array(t))})}),l.addEventListener("webkitkeyadded",function(t){e(t)}),l.addEventListener("webkitkeyerror",function(e){f(e)})})},l=function(e){return function(t,n){o.default.xhr({uri:e,responseType:"arraybuffer"},function(e,t,i){if(e)return void n(e);n(null,new Uint8Array(i))})}},y=function(e,t){return(0,d.getHostnameFromUri)((0,d.uint8ArrayToString)(t))},c=function(e){return function(t,n,i,r){o.default.xhr({uri:e,method:"POST",responseType:"arraybuffer",body:i,headers:{"Content-type":"application/octet-stream"}},function(e,t,n){if(e)return void r(e);r(null,n)})}},p=function(e){var t=e.video,n=e.initData,i=e.options,r=e.player,a=i.keySystems["com.apple.fps.1_0"],s=a.getCertificate||l(a.certificateUri),d=a.getContentId||y,u=a.getLicense||c(a.licenseUri);return new Promise(function(e,t){s(i,function(n,i){if(n)return void t(n);e(i)})}).then(function(e){return f({video:t,cert:e,initData:n,getLicense:u,options:i,contentId:d(i,n),player:r})}).catch(o.default.log.error.bind(o.default.log.error))};n.default=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./utils":5,"global/window":6}],3:[function(e,t,n){(function(t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,o=i(r),a=e("global/window"),s=i(a),d=e("./playready");n.PLAYREADY_KEY_SYSTEM="com.microsoft.playready";var u=function(e,t,n,i){var r=e.keySystems["com.microsoft.playready"];if("function"==typeof r.getKey)return void r.getKey(e,n.destinationURL,n.message.buffer,function(e,n){if(e)return void o.default.log.error("Unable to get key: "+e);t.update(n)});"string"==typeof r&&(r={url:r});var a=r.url||n.destinationURL;(0,d.requestPlayreadyLicense)(a,n.message.buffer,function(e,n){if(i&&i.tech_&&i.tech_.trigger("licenserequestattempted"),e)return void o.default.log.error("Unable to request key from url: "+a);t.update(new Uint8Array(n.body))})};n.addKeyToSession=u;var f=function(e,t,n,i){var r=e.msKeys.createSession("video/mp4",t);if(!r)return void o.default.log.error("Could not create key session.");r.addEventListener("mskeymessage",function(e){u(n,r,e,i)}),r.addEventListener("mskeyerror",function(e){o.default.log.error("Unexpected key error from key session with code: "+r.error.code+" and systemCode: "+r.error.systemCode)})};n.createSession=f,n.default=function(e){var t=e.video,n=e.initData,i=e.options,r=e.player;t.msKeys&&delete t.msKeys;try{t.msSetMediaKeys(new s.default.MSMediaKeys("com.microsoft.playready"))}catch(e){return void o.default.log.error("Unable to create media keys for PlayReady key system. Error: "+e.message)}f(t,n,i,r)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./playready":4,"global/window":6}],4:[function(e,t,n){(function(t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,o=i(r),a=e("global/window"),s=i(a),d=function(e){var t=(new DOMParser).parseFromString(String.fromCharCode.apply(null,new Uint16Array(e)),"application/xml"),n=t.getElementsByTagName("HttpHeaders")[0],i={};if(n)for(var r=n.getElementsByTagName("name"),o=n.getElementsByTagName("value"),a=0;a<r.length;a++)i[r[a].childNodes[0].nodeValue]=o[a].childNodes[0].nodeValue;var d=t.getElementsByTagName("Challenge")[0],u=void 0;return d&&(u=s.default.atob(d.childNodes[0].nodeValue)),{headers:i,message:u}};n.getMessageContents=d;var u=function(e,t,n){var i=d(t),r=i.headers,a=i.message;o.default.xhr({uri:e,method:"post",headers:r,body:a,responseType:"arraybuffer"},n)};n.requestPlayreadyLicense=u}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"global/window":6}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(e){for(var t=new ArrayBuffer(2*e.length),n=new Uint16Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n};n.stringToUint16Array=i;var r=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))};n.uint8ArrayToString=r;var o=function(e){var t=document.createElement("a");return t.href=e,t.hostname};n.getHostnameFromUri=o;var a=function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),i=new DataView(t),r=0;r<n.byteLength;r++)if(n.getUint8(r)!==i.getUint8(r))return!1;return!0};n.arrayBuffersEqual=a;var s=function(e){return e instanceof Uint8Array||e instanceof Uint16Array?e.buffer:e};n.arrayBufferFrom=s},{}],6:[function(e,t,n){(function(e){var n;n="undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{},t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(e,t,n){(function(t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var r="undefined"!=typeof window?window.videojs:void 0!==t?t.videojs:null,o=i(r),a=e("./eme"),s=e("./fairplay"),d=i(s),u=e("./ms-prefixed"),f=i(u),l=e("./utils"),y=function(e,t){for(var n=0;n<e.length;n++)if(e[n].initData&&(0,l.arrayBuffersEqual)((0,l.arrayBufferFrom)(e[n].initData),(0,l.arrayBufferFrom)(t)))return!0;return!1};n.hasSession=y;var c=function(e,t){for(var n=0;n<e.length;n++)if(e[n].initData===t)return void e.splice(n,1)};n.removeSession=c;var p=function(e,t,n,i){if(!t||!t.keySystems)return Promise.resolve();var r=e.initData;return(0,a.getSupportedKeySystem)(t.keySystems).then(function(o){var s=o.keySystem;if(t.keySystems[s]&&t.keySystems[s].pssh&&(r=t.keySystems[s].pssh),!y(n,r))return n.push({initData:r}),(0,a.standard5July2016)({video:e.target,initDataType:e.initDataType,initData:r,options:t,removeSession:c.bind(null,n),player:i})})};n.handleEncryptedEvent=p;var v=function(e,t,n){if(t.keySystems&&t.keySystems[s.FAIRPLAY_KEY_SYSTEM])return(0,d.default)({video:e.target,initData:e.initData,options:t,player:n})};n.handleWebKitNeedKeyEvent=v;var g=function(e,t,n,i){t.keySystems&&t.keySystems[u.PLAYREADY_KEY_SYSTEM]&&(n.reduce(function(e,t){return e||t.playready},!1)||(n.push({playready:!0}),(0,f.default)({video:e.target,initData:e.initData,options:t,player:i})))};n.handleMsNeedKeyEvent=g;var m=function(e){return o.default.mergeOptions(e.currentSource(),e.eme.options)};n.getOptions=m;var w=function(e){var t=e.src();t!==e.eme.activeSrc&&(e.eme.activeSrc=t,e.eme.sessions=[])};n.setupSessions=w;var h=function(e){"video"===e.$(".vjs-tech").tagName.toLowerCase()&&(w(e),e.tech_.el_.addEventListener("encrypted",function(t){w(e),p(t,m(e),e.eme.sessions,e)}),e.tech_.el_.addEventListener("webkitneedkey",function(t){w(e),v(t,m(e),e)}),o.default.browser.IS_EDGE||e.tech_.el_.addEventListener("msneedkey",function(t){w(e),g(t,m(e),e.eme.sessions)}))},b=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.eme.options=t,this.ready(function(){return h(e)})};(o.default.registerPlugin||o.default.plugin)("eme",b),n.default=b}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./eme":1,"./fairplay":2,"./ms-prefixed":3,"./utils":5}]},{},[7])(7)});
!function(d,s,e,t){"use strict";var i="bstree",a="plugin_"+i,n={DEBUG:!1,dataSource:"",initValues:"",dataSeparator:":",chevronOpened:'<i class="fa fa-toggle-down fa-lg"></i>',chevronClosed:'<i class="fa fa-toggle-right fa-lg"></i>',isExpanded:!1,nodeClass:i+"-node",compositeClass:i+"-composite",leafClass:i+"-leaf",childrenClass:i+"-children",innerContainerClass:i+"-inner-container",chevronClass:i+"-chevron",labelClass:i+"-label",labelContainerClass:i+"-label-container",iconClass:i+"-icon",expandedClass:i+"-expanded",closedClass:i+"-closed",checkboxClass:i+"-checkbox",incompleteClass:i+"-incomplete",vLineClass:i+"-vline",dataClass:i+"-data",openTitle:"Open",closeTitle:"Close",checkboxTitle:"Do action",updateNodeTitle:null,onDataPush:null};function l(l,s){this.element=l,this.settings=d.extend({},n,s),this._defaults=n,this._name=i,this._vItem={setInitCount:function(s,e){var t=s.children("ul").children("li").length;s.children("ul").children(e._dotVLineClass).attr("data-vitems",t)},setCount:function(n,l,i){var o=i.getCount(n,l);n.hasClass(l.closedClass)?(o=-o,n.find(l._dotCompositeClass).each(function(){d(this).hasClass(l.expandedClass)&&d(this).is("li:last-child")&&(o-=i.getCount(d(this),l))})):n.hasClass(l.expandedClass)&&n.find(l._dotCompositeClass).each(function(){d(this).hasClass(l.expandedClass)&&d(this).is("li:last-child")&&(o+=i.getCount(d(this),l))}),l.DEBUG&&console.log("count = "+o),n.parents(l._dotCompositeClass).each(function(s){var e=d(this),t=i.getCount(e,l),a=t+o;0===s&&n.is("li:last-child")&&(a=t),l.DEBUG&&console.log(s+" : "+a),e.children("ul").children(l._dotVLineClass).attr("data-vitems",a)})},getCount:function(s,e){var t=s.children("ul").children(e._dotVLineClass).attr("data-vitems");return void 0===t?-1:parseInt(t)},setHeight:function(s,e,t){var a=t.getCount(s,e),n=0;n=l.hasClass(e.dataClass)?(a-1)*e._datavItemHeight+e._datavLineOffset:(a-1)*e._vItemHeight+e._vLineOffset,s.children("ul").children(e._dotVLineClass).css("height",n)}},this.element.openNode=function(s,e){s.children("ul").show(),s.addClass(e.expandedClass).removeClass(e.closedClass),s.children("div").children(e._dotChevronClass).html(e.chevronOpened+"&nbsp;").attr("title",e.closeTitle)},this.element.closeNode=function(s,e){s.children("ul").hide(),s.addClass(e.closedClass).removeClass(e.expandedClass),s.children("div").children(e._dotChevronClass).html(e.chevronClosed+"&nbsp;").attr("title",e.openTitle)},this._data={},this.settings.dataSource.length&&(this._data={separator:this.settings.dataSeparator,source:this.settings.dataSource,initValues:this.settings.initValues.split(this.settings.dataSeparator),values:this.settings.dataSource.val().split(this.settings.dataSeparator),push:function(s){this.source.val(this.values.join(this.separator)),"function"==typeof s.onDataPush&&s.onDataPush(this.values)},pull:function(){this.values=this.source.val().split(this.separator)},resetIndeterminate:function(s,e){s.removeClass(e.incompleteClass),s.find(e._dotCompositeClass).removeClass(e.incompleteClass),s.children(".checkbox").find(e._dotCheckboxClass).prop("indeterminate",!1),s.find(e._dotCompositeClass).children(".checkbox").find(e._dotCheckboxClass).prop("indeterminate",!1)},propagateToChildren:function(s,e,t){s.find(t._dotCheckboxClass).prop("checked",e)},propagateToParent:function(s,i){s.parents(i._dotNodeClass).each(function(){var s=d(this),t=0;s.children(i._dotInnerContainerClass).find(i._dotCheckboxClass).prop("checked")&&t++;var e=s.siblings("li"),a=e.length+1;d.each(e,function(s,e){d(e).children(i._dotInnerContainerClass).find(i._dotCheckboxClass).prop("checked")&&t++}),i.DEBUG&&console.log(s.data("level")+" check = "+t+"/"+a);var n=s.parent("ul").parent("li");if(n.length){var l=n.children(i._dotInnerContainerClass).find(i._dotCheckboxClass);t===a?l.prop("indeterminate",!1).prop("checked",!0):0===t?(l.prop("indeterminate",!1).prop("checked",!1),n.find("input:checked").length&&l.prop("indeterminate",!0)):l.prop("indeterminate",!0).prop("checked",!1)}})},getLeafData:function(t){var a=[];l.find(t._dotCheckboxClass).each(function(){var s=d(this).closest(t._dotLeafClass);if(d(this).prop("checked")&&s.length){var e=s.data("id");a.push(e)}}),this.values=a}}),this.init()}d.extend(l.prototype,{init:function(){var e=this.element,a=this.settings,t=this._vItem,n=this._data;if(0===e.length)throw i+" - the element is not valid.";if(a._dotNodeClass="."+a.nodeClass,a._dotCompositeClass="."+a.compositeClass,a._dotLeafClass="."+a.leafClass,a._dotChildrenClass="."+a.childrenClass,a._dotChevronClass="."+a.chevronClass,a._dotExpandedClass="."+a.expandedClass,a._dotCheckboxClass="."+a.checkboxClass,a._dotLabelClass="."+a.labelClass,a._dotIconClass="."+a.iconClass,a._dotVLineClass="."+a.vLineClass,a._vLineOffset=12,a._datavLineOffset=12,a._vItemHeight=32,a._datavItemHeight=32,a._dotLabelContainerClass="."+a.labelContainerClass,a._dotInnerContainerClass="."+a.innerContainerClass,e.find("li").each(function(){var s=d(this);s.has("ul").length?s.addClass(a.nodeClass+" "+a.compositeClass):s.addClass(a.nodeClass+" "+a.leafClass)}),e.children("ul").find("ul").addClass(a.childrenClass).prepend('<i class="'+a.vLineClass+'"></i>'),e.find("li > span").addClass(a.labelClass).wrap('<div class="'+a.innerContainerClass+'"></div>').wrap('<label class="'+a.labelContainerClass+'"></label>'),e.find(a._dotLabelClass).before('<span class="'+a.iconClass+'"></span>').parent("label").before('<span class="'+a.chevronClass+'"></span>'),e.find(a._dotNodeClass).each(function(){if("function"==typeof a.updateNodeTitle){var s=d(this),e=s.children("div").find(a._dotLabelClass);e.html(a.updateNodeTitle(s,e.text()))}}),e.find(a._dotCompositeClass).each(function(){a.isExpanded?e.openNode(d(this),a):(e.closeNode(d(this),a),t.setInitCount(d(this),a))}),e.find(a._dotChevronClass).click(function(){var s=d(this).closest(a._dotCompositeClass);s.hasClass(a.closedClass)?e.openNode(s,a):s.hasClass(a.expandedClass)&&e.closeNode(s,a),t.setCount(s,a,t)}),!d.isEmptyObject(n)){e.addClass(a.dataClass),e.find(a._dotNodeClass).each(function(s,e){var t=d(e).data("id");d(e).find("label").first().attr("for",a.checkboxClass+"-"+t).addClass("custom-control-label").wrap('<div class="custom-control custom-checkbox" style="display: inline-block"></div>'),d(e).find(".custom-control.custom-checkbox").first().prepend('<input id="'+a.checkboxClass+"-"+t+'" type="checkbox" class="custom-control-input '+a.checkboxClass+'" title="'+a.checkboxTitle+'">')}),n.pull(),e.find(a._dotCheckboxClass).change(function(){var s=d(this);if(0===s.closest(a._dotLeafClass).length){var e=d(this).closest(a._dotNodeClass);n.resetIndeterminate(e,a),s.prop("checked")?n.propagateToChildren(e,!0,a):n.propagateToChildren(e,!1,a)}n.propagateToParent(s,a),n.getLeafData(a),n.push(a)});for(var s=0;s<n.initValues.length;s++)e.find(a._dotNodeClass).each(function(){d(this).data("id")===n.initValues[s]&&(n.propagateToChildren(d(this),!0,a),d(this).find(a._dotCheckboxClass).change())})}}}),d.fn[i]=function(s){var e=this.data(a);return e instanceof l?void 0!==s&&e.init(s):(e=new l(this,s),this.data(a,e)),e}}(jQuery,window,document);
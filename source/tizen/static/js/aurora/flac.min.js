!function e(r,t,a){function i(o,n){if(!t[o]){if(!r[o]){var d="function"==typeof require&&require;if(!n&&d)return d(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var h=t[o]={exports:{}};r[o][0].call(h.exports,function(e){var t=r[o][1][e];return i(t?t:e)},h,h.exports,e,r,t,a)}return t[o].exports}for(var s="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(e,r,t){t.FLACDemuxer=e("./src/demuxer"),t.FLACDecoder=e("./src/decoder"),e("./src/ogg")},{"./src/decoder":2,"./src/demuxer":3,"./src/ogg":4}],2:[function(e,r,t){var a=window.AV,i=a.Decoder.extend(function(){function e(e,r,t){var a=r*t,i=0>a;i&&(a=-a);var s=a%c|0,o=a/c|0;i&&(s=~s+1,o=~o);var n=e[1]>>>16,d=65535&e[1],h=e[0]>>>16,f=65535&e[0],l=o>>>16,u=65535&o,v=s>>>16,m=65535&s,p=0,w=0,b=0,I=0;I+=f+m,b+=I>>>16,I&=65535,b+=h+v,w+=b>>>16,b&=65535,w+=d+u,p+=w>>>16,w&=65535,p+=n+l,p&=65535,e[0]=b<<16|I,e[1]=p<<16|w}function r(e){for(var r=0,t=0;;){if(t=e>>>24)break;if(r+=8,t=e>>>16,255&t)break;if(r+=8,t=e>>>8,255&t)break;if(r+=8,t=e,255&t)break;return r+=8}return 240&t?t>>>=4:r+=4,8&t?r:4&t?r+1:2&t?r+2:1&t?r+3:r+4}a.Decoder.register("flac",this),this.prototype.setCookie=function(e){this.cookie=e,this.decoded=[];for(var r=0;r<this.format.channelsPerFrame;r++)this.decoded[r]=new Int32Array(e.maxBlockSize);this.lpc_total=new Int32Array(2)};const t=new Int16Array([0,192,576,1152,2304,4608,0,0,256,512,1024,2048,4096,8192,16384,32768]),i=new Int32Array([0,88200,176400,192e3,8e3,16e3,22050,24e3,32e3,44100,48e3,96e3,0,0,0,0]),s=new Int8Array([0,8,12,0,16,20,24,0]),o=8,n=0,d=8,h=9,f=10;this.prototype.readChunk=function(){var e=this.bitstream;if(e.available(32)){if(32764!==(32767&e.read(15)))throw new Error("Invalid sync code");var r=(e.read(1),e.read(4)),a=e.read(4),c=e.read(4),l=e.read(3);e.advance(1),this.chMode=c;var u;if(o>c)u=c+1,this.chMode=n;else{if(!(f>=c))throw new Error("Invalid channel mode");u=2}if(u!==this.format.channelsPerFrame)throw new Error("Switching channel layout mid-stream not supported.");if(3===l||7===l)throw new Error("Invalid sample size code");if(this.bps=s[l],this.bps!==this.format.bitsPerChannel)throw new Error("Switching bits per sample mid-stream not supported.");for(var v=0;1===e.read(1);)v++;for(var m=e.read(7-v);v>1;v--)e.advance(2),m=m<<6|e.read(6);if(0===r)throw new Error("Reserved blocksize code");6===r?this.blockSize=e.read(8)+1:7===r?this.blockSize=e.read(16)+1:this.blockSize=t[r];var p;if(12>a)p=i[a];else if(12===a)p=1e3*e.read(8);else if(13===a)p=e.read(16);else{if(14!==a)throw new Error("Invalid sample rate code");p=10*e.read(16)}e.advance(8);for(var w=0;u>w;w++)this.decodeSubframe(w);e.align(),e.advance(16);var b=this.bps>16,I=new ArrayBuffer(this.blockSize*u*(b?4:2)),k=b?new Int32Array(I):new Int16Array(I),S=this.blockSize,g=this.decoded,y=0;switch(this.chMode){case n:for(var z=0;S>z;z++)for(var w=0;u>w;w++)k[y++]=g[w][z];break;case d:for(var w=0;S>w;w++){var A=g[0][w],U=g[1][w];k[y++]=A,k[y++]=A-U}break;case h:for(var w=0;S>w;w++){var A=g[0][w],U=g[1][w];k[y++]=A+U,k[y++]=U}break;case f:for(var w=0;S>w;w++){var A=g[0][w],U=g[1][w];A-=U>>1,k[y++]=A+U,k[y++]=A}}return k}},this.prototype.decodeSubframe=function(e){var r=0,t=this.bitstream,a=this.blockSize,i=this.decoded;if(this.curr_bps=this.bps,0===e?this.chMode===h&&this.curr_bps++:(this.chMode===d||this.chMode===f)&&this.curr_bps++,t.read(1))throw new Error("Invalid subframe padding");var s=t.read(6);if(t.read(1)){for(r=1;!t.read(1);)r++;this.curr_bps-=r}if(this.curr_bps>32)throw new Error("decorrelated bit depth > 32 ("+this.curr_bps+")");if(0===s)for(var o=t.read(this.curr_bps,!0),n=0;a>n;n++)i[e][n]=o;else if(1===s)for(var c=this.curr_bps,n=0;a>n;n++)i[e][n]=t.read(c,!0);else if(s>=8&&12>=s)this.decode_subframe_fixed(e,-9&s);else{if(!(s>=32))throw new Error("Invalid coding type");this.decode_subframe_lpc(e,(-33&s)+1)}if(r)for(var n=0;a>n;n++)i[e][n]<<=r},this.prototype.decode_subframe_fixed=function(e,r){for(var t=this.decoded[e],a=this.bitstream,i=this.curr_bps,s=0;r>s;s++)t[s]=a.read(i,!0);this.decode_residuals(e,r);var o=0,n=0,d=0,h=0;switch(r>0&&(o=t[r-1]),r>1&&(n=o-t[r-2]),r>2&&(d=n-t[r-2]+t[r-3]),r>3&&(h=d-t[r-2]+2*t[r-3]-t[r-4]),r){case 0:break;case 1:case 2:case 3:case 4:for(var f=new Int32Array([o,n,d,h]),c=this.blockSize,s=r;c>s;s++){f[r-1]+=t[s];for(var l=r-2;l>=0;l--)f[l]+=f[l+1];t[s]=f[0]}break;default:throw new Error("Invalid Predictor Order "+r)}},this.prototype.decode_subframe_lpc=function(r,t){for(var a=this.bitstream,i=this.decoded[r],s=this.curr_bps,o=this.blockSize,n=0;t>n;n++)i[n]=a.read(s,!0);var d=a.read(4)+1;if(16===d)throw new Error("Invalid coefficient precision");var h=a.read(5,!0);if(0>h)throw new Error("Negative qlevel, maybe buggy stream");for(var f=new Int32Array(32),n=0;t>n;n++)f[n]=a.read(d,!0);if(this.decode_residuals(r,t),this.bps<=16){for(var n=t;o-1>n;n+=2){for(var c=i[n-t],l=0,u=0,v=0,m=t-1;m>0;m--)v=f[m],l+=v*c,c=i[n-m],u+=v*c;v=f[0],l+=v*c,c=i[n]+=l>>h,u+=v*c,i[n+1]+=u>>h}if(o>n){for(var p=0,m=0;t>m;m++)p+=f[m]*i[n-m-1];i[n]+=p>>h}}else for(var w=this.lpc_total,n=t;o>n;n++){for(w[0]=0,w[1]=0,m=0;t>m;m++)e(w,f[m],i[n-m-1]);i[n]+=w[0]>>>h|w[1]<<32-h}};const c=Math.pow(2,32),l=32767;this.prototype.decode_residuals=function(e,r){var t=this.bitstream,a=t.read(2);if(a>1)throw new Error("Illegal residual coding method "+a);var i=t.read(4),s=this.blockSize>>>i;if(r>s)throw new Error("Invalid predictor order "+r+" > "+s);for(var o=this.decoded[e],n=r,d=r,h=0;1<<i>h;h++){var f=t.read(0===a?4:5);if(f===(0===a?15:31))for(f=t.read(5);s>d;d++)o[n++]=t.read(f,!0);else for(;s>d;d++)o[n++]=this.golomb(f,l,0);d=0}};this.prototype.golomb=function(e,t,a){var i=this.bitstream,s=i.bitPosition,o=i.peek(32-s)<<s,n=0,d=31-r(1|o);if(d-e>=7&&t>32-d)o>>>=d-e,o+=30-d<<e,i.advance(32+e-d),n=o;else{for(var h=0;0===i.read(1);h++)o=i.peek(32-s)<<s;t-1>h?(o=e?i.read(e):0,n=o+(h<<e)):h===t-1?(o=i.read(a),n=o+1):n=-1}return n>>1^-(1&n)}});r.exports=i},{}],3:[function(e,r,t){var a=window.AV,i=a.Demuxer.extend(function(){a.Demuxer.register(this),this.probe=function(e){return"fLaC"===e.peekString(0,4)};const e=0,r=3,t=4,i=6,s=34;this.prototype.readChunk=function(){var o=this.stream;if(!this.readHeader&&o.available(4)){if("fLaC"!==o.readString(4))return this.emit("error","Invalid FLAC file.");this.readHeader=!0}for(;o.available(1)&&!this.last;){if(!this.readBlockHeaders){var n=o.readUInt8();this.last=128===(128&n),this.type=127&n,this.size=o.readUInt24()}if(!this.foundStreamInfo&&this.type!==e)return this.emit("error","STREAMINFO must be the first block");if(!o.available(this.size))return;switch(this.type){case e:if(this.foundStreamInfo)return this.emit("error","STREAMINFO can only occur once.");if(this.size!==s)return this.emit("error","STREAMINFO size is wrong.");this.foundStreamInfo=!0;var d=new a.Bitstream(o),h={minBlockSize:d.read(16),maxBlockSize:d.read(16),minFrameSize:d.read(24),maxFrameSize:d.read(24)};this.format={formatID:"flac",sampleRate:d.read(20),channelsPerFrame:d.read(3)+1,bitsPerChannel:d.read(5)+1},this.emit("format",this.format),this.emit("cookie",h);var f=d.read(36);this.emit("duration",f/this.format.sampleRate*1e3|0),o.advance(16),this.readBlockHeaders=!1;break;case r:for(var c=0;c<this.size/18;c++)if(4294967295==o.peekUInt32(0)&&4294967295==o.peekUInt32(1))o.advance(18);else{o.readUInt32()>0&&this.emit("error","Seek points with sample number >UInt32 not supported");var l=o.readUInt32();o.readUInt32()>0&&this.emit("error","Seek points with stream offset >UInt32 not supported");var u=o.readUInt32();o.advance(2),this.addSeekPoint(u,l)}break;case t:this.metadata||(this.metadata={});var v=o.readUInt32(!0);this.metadata.vendor=o.readString(v);for(var m=o.readUInt32(!0),p=0;m>p;p++){v=o.readUInt32(!0);var w=o.readString(v,"utf8"),b=w.indexOf("=");this.metadata[w.slice(0,b).toLowerCase()]=w.slice(b+1)}break;case i:var I=o.readUInt32();if(3!==I)o.advance(this.size-4);else{var k=o.readUInt32(),S=(o.readString(k),o.readUInt32()),m=(o.readString(S),o.readUInt32(),o.readUInt32(),o.readUInt32(),o.readUInt32(),o.readUInt32()),g=o.readBuffer(m);this.metadata||(this.metadata={}),this.metadata.coverArt=g}break;default:o.advance(this.size),this.readBlockHeaders=!1}this.last&&this.metadata&&this.emit("metadata",this.metadata)}for(;o.available(1)&&this.last;){var y=o.readSingleBuffer(o.remainingBytes());this.emit("data",y)}}});r.exports=i},{}],4:[function(e,r,t){var a=window.AV;try{var i=window.AV.OggDemuxer}catch(s){}i&&i.plugins.push({magic:"FLAC",init:function(){this.list=new a.BufferList,this.stream=new a.Stream(this.list)},readHeaders:function(e){var r=this.stream;if(this.list.append(new a.Buffer(e)),r.advance(5),1!=r.readUInt8())throw new Error("Unsupported FLAC version");if(r.advance(3),"fLaC"!=r.peekString(0,4))throw new Error("Not flac");if(this.flac=a.Demuxer.find(r.peekSingleBuffer(0,r.remainingBytes())),!this.flac)throw new Error("Flac demuxer not found");return this.flac.prototype.readChunk.call(this),!0},readPacket:function(e){this.list.append(new a.Buffer(e)),this.flac.prototype.readChunk.call(this)}})},{}]},{},[1]);
